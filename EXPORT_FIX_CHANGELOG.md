# Исправления экспорта отчетов в Excel

## Дата: ${new Date().toLocaleDateString('ru-RU')}

## Проблемы, которые были исправлены:

1. **Неправильная структура данных при экспорте** - данные экспортировались как HTML таблица, а не как структурированные данные
2. **Отсутствие информации о датах и кассе** в экспортированных файлах
3. **Смешанные данные в колонках** - в одной колонке могли быть и суммы, и текст
4. **Неправильное форматирование** - числа экспортировались как текст

## Внесенные изменения в payroll.js:

### 1. Функция exportRevenueToExcel()
- Теперь экспортирует структурированные данные с колонками: №, Дата выручки, Торговая точка, Выручка, Статус
- Добавлена итоговая строка с общей суммой выручки
- Правильное форматирование чисел

### 2. Функция exportDailyPayrollToExcel()
- Экспортирует полные данные включая: Дата, Магазин, Сотрудник, Касса магазина, Ставка, Бонус
- Добавлен второй лист со сводкой (дата расчета, количество сотрудников, общая сумма)
- Корректная обработка старших продавцов

### 3. Функция exportMonthlyReportToExcel()
- Полная детализация с колонками: Сотрудник, Магазин, База, Премии, Штрафы, Недостачи, Аванс, Остаток, Наличные, Итого
- Второй лист "Сводка по магазинам" с агрегированными данными
- Включены рабочие дни сотрудников

### 4. Функция exportFotReportToExcel()
- Структурированный экспорт данных ФОТ по магазинам
- Второй лист "Сводная информация" с итогами и параметрами расчета
- Правильный расчет процентов ФОТ

## Технические детали:

- Удалена устаревшая функция exportToExcelWithFormatting()
- Все функции теперь используют XLSX.utils.json_to_sheet() для правильного экспорта
- Добавлены правильные ширины колонок для каждого типа отчета
- Числовые данные теперь экспортируются как числа, а не как текст

## Файлы:
- Основной файл: `payroll.js`
- Резервная копия: `payroll_backup_before_export_fix.js`
- Удален временный файл: `payroll_export_fix.js`

## Команды для деплоя:

```bash
# Добавить изменения
git add public/payroll.js

# Создать коммит
git commit -m "fix: Исправлен экспорт отчетов в Excel - теперь экспортируются структурированные данные с правильным форматированием"

# Отправить на GitHub
git push origin main

# Задеплоить на Fly.io
fly deploy
```